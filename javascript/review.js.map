{"version":3,"sources":["review.es6"],"names":[],"mappings":"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","file":"review.js","sourcesContent":["$(function () {\n    var form = $(\"form.add_review_form\");\n    if (form.length) {\n        var addText = form.find(\".add_reviews_text\");\n        var textView = form.find(\"textarea.add_reviews_textarea\");\n        textView.bind(\"input propertychange\", function () {\n            var textValue = $.trim(textView.val());\n            addText.toggleClass(\"hide\", textValue.length < 190)\n                .toggleClass(\"error\", textValue.length > 200)\n                .html(200 - textValue.length);\n        });\n        var button = form.find(\".add_reviews_sendbtn\");\n        button.click(function () {\n            if (button.hasClass(\"disable\")) {\n                return false;\n            }\n            var value = $.trim(textView.val());\n            if (value == \"\") {\n                bravetime.info(\"未填写推荐理由哟~\");\n                return false;\n            }\n            if (value.length > 200) {\n                bravetime.info(\"不能超过200字哦\");\n                return false;\n            }\n            button.addClass(\"disable\").html(`<img src=\"//pic.davdian.com/free/loading_32.gif\"/>提交中...`);\n            form.ajaxSubmit({dataType: \"json\", type: \"post\", data: {content: value}, success, error});\n            function success(result) {\n                button.removeClass(\"disable\").html(\"提交\");\n                var {error,msg,callbackUrl}=result;\n                if (error) {\n                    bravetime.info(msg);\n                } else {\n                    bravetime.info(\"提交成功\");\n                    bravetime.goto(callbackUrl);\n                }\n            }\n\n            function error() {\n                button.removeClass(\"disable\").html(\"提交\");\n                bravetime.ajaxError(27);\n            }\n        });\n    }\n\n\n    var singleReview = $(\".single_review\");\n    singleReview.find(\".delete\").click(function () {\n        var me = this;\n        var id = $(this).parents(\".reviews_list\").attr(\"data-id\");\n        bravetime.newConfirm(\"您确定要删除么?\", {\n            okLink: function () {\n                bravetime.addLoader({little: true});\n                $(this).addClass(\"disable\");\n                $.ajax({\n                    url: deleteReviewUrl,\n                    data: {id},\n                    dataType: \"json\",\n                    success,\n                    error\n                });\n                function success(result) {\n                    bravetime.removeLoader();\n                    var {error,msg} = result;\n                    if (error) {\n                        bravetime.info(msg);\n                    } else {\n                        //bravetime.info(`删除成功`);\n                        singleReview.find(\".reviewed\").addClass(\"hide\");\n                        singleReview.find(\".to_review\").removeClass(\"hide\");\n                    }\n                }\n\n                function error() {\n                    bravetime.ajaxError(28);\n                    bravetime.removeLoader();\n                    $(me).removeClass(\"disable\");\n                }\n            }\n        });\n\n    });\n\n\n    var reviewGroup = $(\".review_group\");\n    if (reviewGroup.length) {\n        reviewGroup.find(\".delete\").click(function () {\n            var me = this;\n            var id = $(this).parents(\".reviews_list\").attr(\"data-id\");\n            bravetime.newConfirm(\"您确定要删除么?\", {\n                okLink: function () {\n                    bravetime.addLoader({little: true});\n                    $(this).addClass(\"disable\");\n                    $.ajax({\n                        url: deleteReviewUrl,\n                        data: {id},\n                        dataType: \"json\",\n                        success,\n                        error\n                    });\n                    function success(result) {\n                        bravetime.removeLoader();\n                        $(me).removeClass(\"disable\");\n                        var {error,msg} = result;\n                        if (error) {\n                            bravetime.info(msg);\n                        } else {\n                            //bravetime.info(`删除成功`);\n                            $(me).parents(\".reviews_list\").addClass(\"hide\");\n                        }\n                        // 添加评论按钮展示\n                        $(\".right_icon_container\").removeClass(\"hide\");\n                    }\n\n                    function error() {\n                        bravetime.ajaxError(28);\n                        bravetime.removeLoader();\n                        $(me).removeClass(\"disable\");\n                    }\n                }\n            });\n\n        });\n        var loadingContainer = $(\".loading_container\");\n        // 下拉刷新\n        var ajaxing = 0;\n        $(window).scroll(function () {\n            if (ajaxing == 0) {\n                var bodyHeight = $(\"body\").height();\n                var scrollTop = $(\"body\").scrollTop();\n                var windowHeight = $(window).height();\n                if ((bodyHeight - scrollTop - windowHeight) < 100) {\n                    ajaxing = 1;\n                    var lastId = $(reviewGroup[0][\"lastElementChild\"]).attr(\"data-id\");\n                    var data = {lastId};\n                    $.ajax({\n                        url: refreshUrl,\n                        data,\n                        cache: false,\n                        dataType: \"json\",\n                        success,\n                        error\n                    });\n                    function success(result) {\n                        var {error, msg, list, hasMore}=result;\n                        if (error) {\n                            bravetime.info(msg);\n                        } else {\n                            if (list.length) {\n                                for (let i = 0, d; d = list[i++];) {\n                                    var {commentId,imgUrl,name,date,con} = d;\n                                    var str = `<div class=\"reviews_list\" data-id=\"${commentId}\"><div class=\"list_title\"><div class=\"pull-right\"><span class=\"pull-right dav-color9\">${date}</span></div><img src=\"${imgUrl}\" class=\"pull-left\"><div class=\"shop_name pull-left\">${name}</div></div><div class=\"list_text\">${con}</div></div>`;\n                                    reviewGroup.append($(str));\n                                }\n                            } else {\n                                loadingContainer.html(\"没有更多了\");\n                            }\n                            if (hasMore == 1) {\n                                ajaxing = 0;\n                            } else {\n                                loadingContainer.html(\"没有更多了\");\n                            }\n                        }\n                    }\n                    function error() {\n                        bravetime.ajaxError(29);\n                        ajaxing = 0;\n                    }\n                }\n            }\n        });\n    }\n});\n"]}